<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario - Wellness & Nutrition</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" href="/static/css/admin.css" />
    <link rel="stylesheet" href="/static/css/calendar.css" />
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div style="text-align: center;">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loading-text">Caricamento...</div>
        </div>
    </div>

    <div class="header">
        <h1>Wellness & Nutrition - Admin</h1>
        <div class="nav">
            <a href="/admin/calendar" class="active">Calendario</a>
            <a href="/admin/users">Utenti</a>
            <a href="/admin/instructors">Istruttori</a>
            <a href="/admin/events">Eventi</a>
            <a href="/admin/survey/results">Sondaggio</a>
            <a href="/api/auth/logout">Esci</a>
        </div>
    </div>
    <div class="container">
        <div class="calendar-container">
            <div class="calendar-header">
                <h2 id="currentMonth" style="margin: 0; font-size: 24px; font-weight: 400;"></h2>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label for="instructorFilter" style="font-size: 14px; font-weight: 500;">Istruttore:</label>
                        <select id="instructorFilter" onchange="onInstructorFilterChange()" style="padding: 8px; border: 1px solid #e0e0e0; border-radius: 4px; font-family: 'Roboto', sans-serif;">
                            <option value="">Tutti</option>
                        </select>
                    </div>
                    <div class="calendar-nav">
                        <button class="btn" onclick="previousPeriod()">
                            <span class="material-icons" style="font-size: 18px;">chevron_left</span>
                        </button>
                        <button class="btn" onclick="today()">Oggi</button>
                        <button class="btn" onclick="nextPeriod()">
                            <span class="material-icons" style="font-size: 18px;">chevron_right</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="calendarView"></div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box single"></div>
                    <span>Abbonamento Singolo</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box shared"></div>
                    <span>Abbonamento Condiviso</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box massage"></div>
                    <span>Massaggio</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box appointment"></div>
                    <span>Appuntamento</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Delete Booking Modal -->
    <div id="deleteBookingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Elimina Prenotazione</h2>
                <button class="close" onclick="closeDeleteBookingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Vuoi eliminare la prenotazione di <strong id="deleteBookingUserName"></strong>?</p>
                <p id="deleteBookingSlotInfo" style="color: #666; margin-top: 10px;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeDeleteBookingModal()">Annulla</button>
                <button type="button" class="btn" style="background-color: #d32f2f;" onclick="confirmDeleteBooking()">Elimina</button>
            </div>
        </div>
    </div>
    <!-- Unreserve Slot Modal -->
    <div id="unreserveSlotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Rilascia Slot Riservato</h2>
                <button class="close" onclick="closeUnreserveSlotModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Vuoi rendere questo slot nuovamente disponibile per le prenotazioni?</p>
                <p id="unreserveSlotInfo" style="color: #666; margin-top: 10px;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeUnreserveSlotModal()">Annulla</button>
                <button type="button" class="btn" style="background-color: #4caf50;" onclick="confirmUnreserveSlot()">Rilascia slot</button>
            </div>
        </div>
    </div>

    <!-- Enable Slot Modal -->
    <div id="enableSlotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Riabilita Slot</h2>
                <button class="close" onclick="closeEnableSlotModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Vuoi riabilitare questo slot?</p>
                <p id="enableSlotInfo" style="color: #666; margin-top: 10px;"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeEnableSlotModal()">Annulla</button>
                <button type="button" class="btn" style="background-color: #4caf50;" onclick="confirmEnableSlot()">Riabilita slot</button>
            </div>
        </div>
    </div>

    <!-- Slot Action Modal -->
    <div id="slotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Gestione Slot</h2>
                <button class="close" onclick="closeSlotModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="actionSelection">
                    <div id="actionUnreserve" class="action-card" style="display: none;" onclick="showUnreserveSlot()">
                        <h3>ðŸ”“ Rilascia Slot</h3>
                        <p>Rendi questo slot nuovamente disponibile per le prenotazioni</p>
                    </div>
                    <div id="actionUnavailable" class="action-card" onclick="showMarkUnavailable()">
                        <h3>ðŸš« Segna come Non Disponibile</h3>
                        <p>Gli utenti non potranno prenotare questo slot</p>
                    </div>
                    <div id="actionMassage" class="action-card" onclick="showReserveMassage()">
                        <h3>ðŸ’† Riserva per Massaggio</h3>
                        <p>Riserva questo slot per un massaggio (gli utenti non potranno prenotare)</p>
                    </div>
                    <div id="actionAppointment" class="action-card" onclick="showReserveAppointment()">
                        <h3>ðŸ“… Riserva per Appuntamento</h3>
                        <p>Riserva questo slot per un appuntamento (gli utenti non potranno prenotare)</p>
                    </div>
                    <div id="actionCreateBooking" class="action-card" onclick="showCreateBooking()">
                        <h3>âž• Crea Prenotazione</h3>
                        <p>Crea una prenotazione per un utente specifico</p>
                    </div>
                    <div id="actionEnableSlot" class="action-card" style="display: none;" onclick="showEnableSlot()">
                        <h3>âœ… Abilita Slot</h3>
                        <p>Rendi disponibile lo slot per un istruttore specifico</p>
                    </div>
                </div>

                <div id="unavailableForm" style="display: none;">
                    <p id="slotInfo" style="margin-bottom: 16px; color: #666;"></p>
                    <div class="form-group">
                        <label>Seleziona Istruttore *</label>
                        <select id="unavailableInstructorId" required>
                            <option value="">Caricamento...</option>
                        </select>
                    </div>
                    <p style="margin-top: 12px;">Sei sicuro di voler segnare questo slot come non disponibile?</p>
                </div>

                <div id="reserveMassageForm" style="display: none;">
                    <p id="slotInfoReserveMassage" style="margin-bottom: 16px; color: #666;"></p>
                    <div class="form-group">
                        <label>Seleziona Istruttore *</label>
                        <select id="massageInstructorId" required>
                            <option value="">Caricamento...</option>
                        </select>
                    </div>
                    <p style="margin-top: 12px;">Sei sicuro di voler riservare questo slot per un massaggio? Gli utenti non potranno prenotarlo.</p>
                </div>

                <div id="reserveAppointmentForm" style="display: none;">
                    <p id="slotInfoReserveAppointment" style="margin-bottom: 16px; color: #666;"></p>
                    <div class="form-group">
                        <label>Seleziona Istruttore *</label>
                        <select id="appointmentInstructorId" required>
                            <option value="">Caricamento...</option>
                        </select>
                    </div>
                    <p style="margin-top: 12px;">Sei sicuro di voler riservare questo slot per un appuntamento? Gli utenti non potranno prenotarlo.</p>
                </div>

                <div id="bookingForm" style="display: none;">
                    <p id="slotInfoBooking" style="margin-bottom: 16px; color: #666;"></p>
                    <div class="form-group">
                        <label>Seleziona Istruttore *</label>
                        <select id="bookingInstructorId" required>
                            <option value="">Caricamento...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Seleziona Utente *</label>
                        <select id="bookingUserId" required>
                            <option value="">Seleziona un utente...</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline" onclick="closeSlotModal()">Annulla</button>
                <button type="button" id="confirmBtn" class="btn" style="display: none;" onclick="confirmAction()">Conferma</button>
            </div>
        </div>
    </div>
    <script src="/static/js/calendar.js"></script>

</body>
</html>
